name: Commits Update

on:
  push:
    branches:
      - main
    paths:
      - 'changelog.txt'
      - 'documentation.html'
      - 'index.html'
      - 'manifest.json'

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get commit info
        run: |
          echo "COMMIT_MSG=$(git log -1 --pretty=%B)" >> $GITHUB_ENV
          echo "COMMIT_AUTHOR=$(git log -1 --pretty=%an)" >> $GITHUB_ENV
          echo "COMMIT_DATE=$(git log -1 --date=format:'%Y-%m-%d %H:%M' --pretty=%ad)" >> $GITHUB_ENV
          echo "COMMIT_URL=https://github.com/${{ github.repository }}/commit/${{ github.sha }}" >> $GITHUB_ENV

      - name: Send Telegram notification
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d message_thread_id="${{ secrets.TELEGRAM_THREAD_COMMIT }}" \
            -d parse_mode=HTML \
            -d disable_web_page_preview=true \
            --data-urlencode "text=âœ¨<b>New Commit</b>âœ¨
      
            <b>Commit:</b> ${{ env.COMMIT_MSG }}
            <b>Author:</b> ${{ env.COMMIT_AUTHOR }}
            <b>Date:</b> ${{ env.COMMIT_DATE }}" \
            -d reply_markup='{
              "inline_keyboard": [
                [
                  {
                    "text": "ðŸ”Ž View Commit",
                    "url": "${{ env.COMMIT_URL }}"
                  }
                ]
              ]
            }'
