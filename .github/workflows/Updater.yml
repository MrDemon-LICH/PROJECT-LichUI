name: Updater Helper

on:
  workflow_dispatch:

jobs:
  Updating:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set date variable
        run: echo "DATE=$(date +'%Y/%m/%d')" >> $GITHUB_ENV

      # üì¢ Send Telegram Message
      - name: Send update message with buttons
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d message_thread_id="${{ secrets.TELEGRAM_THREAD_LICHUI }}" \
            -d parse_mode=HTML \
            --data-urlencode "text=‚ú® <b>NEW UPDATE [${{ env.DATE }}]</b>

            Thank you for using and trusting <b>LichUI ‚ù§</b>

            ¬© 2025 MrDemon-LICH" \
            -d reply_markup='{
              "inline_keyboard": [
                [
                  { "text": "üì• Download", "url": "https://mrdemon-lich.github.io/PROJECT-LichUI/index.html" }
                ],
                [
                  { "text": "üì¶ Old Versions", "url": "https://sourceforge.net/projects/lichrom/files/SM-A546X/" }
                ],
                [
                  { "text": "üìú Changelog", "url": "https://github.com/MrDemon-LICH/PROJECT-LichUI/blob/main/changelog.txt" }
                ]
              ]
            }'

      # üè∑ Create GitHub Release
      - name: Public Update
        uses: softprops/action-gh-release@v2
        with:
          name: Update ${{ env.DATE }}
          tag_name: LICH_UPDATE-${{ env.DATE }}
          body: |
            ### Update Info
            **ROM DATE:** ${{ env.DATE }}
            **OneUI Version:** 8.0

            #### ROM
            - [LichUI](https://sourceforge.net/projects/lichrom/files/SM-A546X/)

            #### Thanks for using LichUI
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
