name: Updater Helper

on:
  workflow_dispatch:

jobs:
  Updating:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set date variable
        id: date
        run: echo "DATE=$(date +'%Y/%m/%d')" >> $GITHUB_ENV

      - name: Send update with image + caption
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d message_thread_id=${{ secrets.TELEGRAM_THREAD_LICHUI }} \
          -d parse_mode=HTML \
          --data-urlencode "text=https://github.com/MrDemon-LICH/PROJECT-LichUI \
          --data-urlencode "text=✨ <b>NEW UPDATE [${{ env.DATE }}]</b>

          https://mrdemon-lich.github.io/PROJECT-LichUI

          <b>Download:</b>
          <blockquote>https://mrdemon-lich.github.io/PROJECT-LichUI/index.html</blockquote>
          <b>Old Versions:</b>
          <blockquote>https://sourceforge.net/projects/lichrom/files/SM-A546X/</blockquote>
          <b>Changelog:</b>
          <blockquote>https://github.com/MrDemon-LICH/PROJECT-LichUI/blob/main/changelog.txt</blockquote>
          
          Thank you for using and trusting <b>LichUI ❤</b>
          
          © 2025 MrDemon-LICH. Prohibited: Modifications, Redistribution, and Partial Usage"

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Public Update
        id: release
        uses: softprops/action-gh-release@v2
        with:
          name: Update ${{ env.DATE }}
          tag_name: LICH_UPDATE-${{ env.DATE }}
          body: |
            ### Update Info
            **ROM DATE:** ${{ env.DATE }}
            **OneUI Version:** 8.0
            #### ROM
            - [LichUI](https://sourceforge.net/projects/lichrom/files/SM-A546X/)   
            #### Thanks for using LichUI

        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
